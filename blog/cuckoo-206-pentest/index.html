<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="description" content="Automated malware analysis with Hatching Triage, the high-volume sandbox solution for SOCs, CERTs, SOARs, and MSSPs.">
    <meta name="keywords" content="Hatching, Hatching Triage, Sandbox, Malware Analysis, Automated Malware Analysis">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="revisit-after" content="3 days">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@hatching_io">
    <meta name="twitter:title" content="Hatching - Automated malware analysis solutions">
    <meta property="og:title" content="Hatching - Automated malware analysis solutions">
    <meta property="og:description" content="Automated malware analysis with Hatching Triage, the high-volume sandbox solution for SOCs, CERTs, SOARs, and MSSPs.">
    <meta property="og:url" content="https://www.hatching.io">
    <link rel="manifest" href="/static/manifest.json">
    
      <meta property="og:image" content="https://www.hatching.io/static/images/backgrounds/resized-1.jpg">
      <meta name="twitter:image" content="https://www.hatching.io/static/images/backgrounds/resized-1.jpg">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123677703-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123677703-1');
    </script>
    <link rel="stylesheet" href="https://hatching.io/static/css/index.css?1726233262">
    <link rel="icon" type="image/png" sizes="32x32" href="https://hatching.io/static/images/favicon-32x32.png?v=21">
    <link rel="icon" type="image/png" sizes="16x16" href="https://hatching.io/static/images/favicon-16x16.png?v=21">
    <title>Cuckoo Sandbox 2.0.6 pentest</title>
  </head>
  <body>
<nav class="site-menu">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/about/">About</a></li>
    <li><a href="/triage/">Triage</a></li>
    <li><a class="active" href="/blog/">Blog</a></li>
    <li><a  href="https://boards.greenhouse.io/recordedfuture" rel="nofollow">Jobs</a></li>
    <li><a href="https://go.recordedfuture.com/enterprise-sandbox-contact-us" target="_blank">Contact</a></li>
  </ul>
</nav>
<header class="site-nav headroom theme-light">
  <div class="logo">
    <a href="/">
      <img width="210px" src="https://hatching.io/static/images/rf-hatching-black.svg" width="164">
    </a>
  </div>
  <div>
    <a href="#" class="toggle-menu">
      Menu
      <span></span>
      <span></span>
      <span></span>
    </a>
  </div>
</header>


<section class="scheme-1 view-context blog-fold blog-article-head" id="fold" data-keep="true">
  <div class="view-context__body">
    <div>
      <div>
        
        <h2>Cuckoo Sandbox 2.0.6 pentest</h2>
      </div>
      <ul>
        <li>Share this:</li>
        <li class="social">
          <a href="https://twitter.com/hatching_io" target="_blank">
            <i class="icon-twitter"></i>
          </a>
          <a href="https://www.linkedin.com/company/hatching" target="_blank">
            <i class="icon-linkedin"></i>
          </a>
          <a href="https://www.github.com/hatching" target="_blank">
            <i class="icon-github"></i>
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h1>Blog.</h1>
    </div>
  </div>
  <div class="background-graphic">
    
      <div class="image" style="background-image: url('/static/images/backgrounds/resized-1.jpg');"></div>
    
  </div>
</section>

<article class="view-context blog-article">
  <header class="blog-article-meta">
    <div class="blog-article-general">
      <p><time datetime="2018-09-18T00:00:00Z">2018-09-18</time></p>
        
          <ul class="blog-article-tags">
            <li><p><a href="/blog/#category=polyswarm">polyswarm</a></p><li><p><a href="/blog/#category=cure53">cure53</a></p><li><p><a href="/blog/#category=pentest">pentest</a></p><li><p><a href="/blog/#category=security">security</a></p>
          </ul>
        
    </div>
    <div class="blog-article-author">
      <div class="avatar">
        <img src="/static/images/avatars/jurriaan.svg" />
      </div>
      <div>
        <h5>Written by <br />Jurriaan Bremer</h5>
      </div>
    </div>
  </header>
  <section class="blog-article-body">
    
      <p><img src="../../static/images/blog/polyswarm.png" alt="Polyswarm">
<img src="../../static/images/blog/cure53.png" alt="Cure53"></p>
<p>Our friends at <a href="https://polyswarm.io/">PolySwarm</a> sponsored a <a href="https://cure53.de/">Cure53</a> pentest of the latest
version of Cuckoo Sandbox (at the time of writing <a href="https://cuckoosandbox.org/blog/206-interim-release">version 2.0.6</a>).
While Cure53 didn&rsquo;t identify any critical issues within the
analysis aspects of Cuckoo, they did point out a few security issues in the
overall architecture of it. Furthermore, they identified a couple of potential
evasion techniques and related issues.</p>
<p>We&rsquo;ve released an alpha candidate for version 2.0.7 of Cuckoo (which may be
installed through <code>pip install cuckoo==2.0.7a1</code>) such that upgrading is
already possible while we finalize some other changes for the official 2.0.7
release.</p>
<p>Furthermore, it should be noted that simply upgrading <code>sflock</code> in an
existing Cuckoo 2.0.6 environment (by running <code>pip install -U sflock</code>)
and restarting Cuckoo will already mitigate issues <code>CSB-01-001</code>,
<code>CSB-01-004</code>, <code>CSB-01-005</code>, <code>CSB-01-008</code>, and <code>CSB-01-010</code> - for more
information on these issues, please read further.</p>
<p>The remainder of this blog post shows how we have tackled the issues, assuring
our users that Hatching and PolySwarm are very serious about security within
Cuckoo Sandbox and related open source projects.</p>
<p>The entire report may be found here: <a href="https://hatching.io/files/cure53-cuckoo.pdf">cure53-cuckoo.pdf</a>.</p>
<p>A total of ten issues were found by Cure53, here goes:</p>
<h2 id="csb-01-009-unauthorized-access-to-web--api">CSB-01-009: Unauthorized access to Web &amp; API</h2>
<p>As Cuckoo Sandbox up until version 2.0.6 didn&rsquo;t have any form of
authentication, anyone could access a Cuckoo instance provided he or she can
reach it through the internet. As an example, one may find various Cuckoo
instances through <a href="https://www.shodan.io/search?query=Server%3A+Machete+Server">Server: Machete Server @ Shodan</a> - what is found within
these search results may result in an entire blogpost on its own though.</p>
<p>We&rsquo;ve implemented <a href="https://swagger.io/docs/specification/authentication/bearer-authentication/">Bearer token</a> support to the <a href="https://github.com/cuckoosandbox/cuckoo/commit/56a21ab6390e0613330af3f0c7a782ad65ff94ca">Cuckoo API</a>. Users that
upgrade their Cuckoo instance will not require a Bearer token for backwards
compatibility reasons. New installations of Cuckoo automatically generate a
random Bearer token which can be found in <code>$CWD/conf/cuckoo.conf</code> under
the <code>api_token</code> field in the <code>[cuckoo]</code> section.</p>
<p>For the Cuckoo Web Interface we&rsquo;ve implemented a <code>secret page</code> where a
shared secret is used to authenticate &amp; get access to the Cuckoo instance. By
default a secret isn&rsquo;t required - to remain backwards compatible - but one may
easily enable it by setting the <code>web_secret</code> field in <code>[cuckoo]</code>
of <code>$CWD/conf/cuckoo.conf</code>.</p>
<figure><img src="../../static/images/blog/secret-form.png"><figcaption>
      <h4>Secret form</h4>
    </figcaption>
</figure>

<h2 id="csb-01-003-webif-reachable-from-inside-a-vm">CSB-01-003: Webif reachable from inside a VM</h2>
<p>On a default Cuckoo setup using VirtualBox (and a VM with IP address
<code>192.168.56.101</code>) the malware that&rsquo;s being analyzed can reach
<code>192.168.56.1</code>, also known as the Cuckoo host. Therefore any services
that aren&rsquo;t listening to localhost or a specific network interface, but
instead to <code>0.0.0.0</code> can be reached from within the VM - it should be
noted that on a default Cuckoo instance, this is not the case.</p>
<p>This can be problematic depending on the exact configuration of the Cuckoo
machine. While other software installed on the machine (e.g., database-related
software such as MySQL/PostgreSQL and MongoDB - often used in Cuckoo setups)
should normally listen only to localhost and therefore not reachable by the
VM, this is not the case for the Cuckoo Web Interface itself.</p>
<p>Currently we have two mitigations for this problem: the Bearer API tokens for
the Cuckoo API &amp; authentication page for the Cuckoo Web Interface (see also
<code>CSB-01-009</code> above) and <code>drop</code> routing using the <a href="https://cuckoo.sh/docs/usage/rooter.html">Cuckoo Rooter</a>.</p>
<p>In a nutshell, the Cuckoo Rooter allows one to perform
<a href="https://cuckoo.sh/docs/installation/host/routing.html#per-analysis-network-routing-options">per-analysis network routing</a>, i.e., one
analysis a VM may be routed through <a href="https://www.torproject.org/">Tor</a> and the next
analysis all of its traffic may be dropped (using <code>drop</code> routing). This
last routing option also affects all non-Cuckoo traffic towards
<code>192.168.56.1</code>, effectively resolving issue <code>CSB-01-003</code>.</p>
<!-- <figure><img src="../../static/images/blog/protected.svg"><figcaption>
      <h4>Protected</h4>
    </figcaption>
</figure>
 -->
<h2 id="csb-01-004--csb-01-010-zip-bombs-as-dos">CSB-01-004 &amp; CSB-01-010: Zip bombs as DoS</h2>
<p>These two issues specifically target Denial of Service problems related to
automatically unpacking potentially unsafe files and/or file formats.
Especially for blackbox file formats such as <code>.7z</code> / <code>.rar</code> /
<code>.cab</code> we as-is can&rsquo;t predict the final filesize of a file. Therefore it
may be possible to upload a small file which extracts to many gigabytes,
essentially using up all server resources - CPU / memory / diskspace.</p>
<p>We have resolved these issues by imposing limits on CPU time and the amount of
data that can be written to disk - by default two minutes of processing time
may be used and 1GB of data may be written. These changes have been
implemented in <a href="https://github.com/jbremer/tracy/compare/dbb5cdbf6fa529c05b096ac764f7a6ffc34d9685...47c02c4affdcf0b0c58046a430161db25d5ddfc2">dbb5cd..47c02c @ zipjail</a> and <a href="https://github.com/jbremer/sflock/commit/5d511c9fa4a4e23964046bdeb0be32829008eecb">5d511c @ sflock</a> and may be
obtained by upgrading <code>sflock</code> to version 0.3.6.</p>
<!-- <figure><img src="../../static/images/blog/zip-bomb.svg"><figcaption>
      <h4>Zip bomb</h4>
    </figcaption>
</figure>
 -->
<h2 id="miscellaneous-issues">Miscellaneous issues</h2>
<p><code>CSB-01-001</code>: Analysis evasion via special characters, resolved in
in <a href="https://github.com/jbremer/sflock/commit/f7b3ff4b9b19bd3b7530bd7cc315fcb30ed1cb64">f7b3ff @ sflock</a> by not allowing files with said filenames to be passed
on for analysis. This is not a complete solution, but it should suffice our
purposes.</p>
<p><code>CSB-01-002</code>: CSRF protection within the Cuckoo Web Interface. This has
been resolved in <a href="https://github.com/cuckoosandbox/cuckoo/compare/5493bee2f218f8b855726630cacdb0d411c1586d...178e5873bc2d52350deb4df99dcdfad00d1a3f1d">5493be..178e58 @ cuckoo</a> by actually implementing CSRF.</p>
<p><code>CSB-01-005</code>: PDF documents are not properly detected. This issue is a
combination of a bug in <code>sflock</code> and a bug in <code>peepdf</code>. While the
<code>sflock</code> issue has been resolved in <a href="https://github.com/jbremer/sflock/commit/0d7547f266b73a110109f997d871649de196bdcc">0d7547 @ sflock</a>, the <code>peepdf</code> issue
is still on our roadmap provided it&rsquo;s not a highly critical issue (our
opinion) and it requires properly delving into the <code>peepdf</code> codebase, which
is not daily routine for us.</p>
<p><code>CSB-01-008</code>: File enumeration bypass in RAR archive via symlink. While
this is not strictly a <code>bypass</code>, it is something where more error reporting to
the end user is better. We&rsquo;re now passing error messages from <code>zipjail</code>
through <code>sflock</code> to the end user of the library, Cuckoo in this case. While
not a complete fix - any archive with embedded symlinks is currently discarded</p>
<ul>
<li>the error propagation is a good step forward. See also <a href="https://github.com/jbremer/sflock/commit/d55f6a9d99a41ebd70e5ea5d266aea718a7f1811">d55f6a @ sflock</a>.</li>
</ul>
<p><code>CSB-01-006</code>: File dropping detection bypass via ADS. This issue has not
yet been resolved and is on our TODO list for the upcoming release of zer0m0n,
as has been announced earlier, i.e., during the version 2.1 release.</p>
<p><code>CSB-01-007</code>: Detection bypass on Windows startup folder installation.
Same as for <code>CSB-01-006</code>, this issue will be released as part of our 2.1
release.</p>
<!-- <figure><img src="../../static/images/blog/clipboard-check.svg"><figcaption>
      <h4>Clipboard</h4>
    </figcaption>
</figure>
 -->
<h2 id="conclusions">Conclusions</h2>
<p>While the pentest performed by Cure53 highlights some interesting issues, some
of which needing proper attention for quite a while now, we&rsquo;re happy to see
that overall the open source development efforts have proven to be secure.
Even more so after a few issues that were reported and fixed over the years.</p>
<p>We&rsquo;d like to thank <a href="https://polyswarm.io/">PolySwarm</a> and <a href="https://cure53.de/">Cure53</a> once again for funding &amp;
performing this pentest, respectively, and hope that these results are a good
showcase for the <code>&quot;many eyes&quot;</code> principle which people sometimes put in a
good or bad daylight when it comes to the security of open source software.</p>
<p>If you (!) find a security issue within Cuckoo Sandbox or one of its
components in the future, don&rsquo;t hesitate to reach to the Cuckoo Sandbox team
(<a href="mailto:cuckoo@cuckoofoundation.org">cuckoo@cuckoofoundation.org</a>) or us
(<a href="mailto:security@hatching.io">security@hatching.io</a>). Keep in mind that
while there&rsquo;s no official bug bounty, we do have stickers &amp; t-shirts and other
swag :-)</p>

    
  </section>
</article>


<section class="view-context blog-recommendations">
  <article class="view-context__body">
    <h2>You may also like:</h2>
    
    <ul>
      
        <li>
          <h3>Emotet Updates, and BazarLoader Emulation</h3>
          <br>
          <a class="button button-variant-3" href="https://hatching.io/blog/tt-2021-11-18/">Read</a>
        </li>
      
        <li>
          <h3>Ep. 137: Triage Thursday</h3>
          <br>
          <a class="button button-variant-3" href="https://hatching.io/blog/tt-2024-06-27/">Read</a>
        </li>
      
        <li>
          <h3>Ep. 133: Triage Thursday</h3>
          <br>
          <a class="button button-variant-3" href="https://hatching.io/blog/tt-2024-05-23/">Read</a>
        </li>
      
        <li>
          <h3>Ep. 105: Triage Thursday</h3>
          <br>
          <a class="button button-variant-3" href="https://hatching.io/blog/tt-2023-10-19/">Read</a>
        </li>
      
    </ul>
  </article>
</section>
    <footer class="scheme-4 view-context footer" id="contact">
      <article class="view-context__body">
        <h2>Want to know more?<br />Get in touch!</h2>
        <a class="button button-variant-1" target="_blank" href="https://go.recordedfuture.com/enterprise-sandbox-contact-us" i>Contact us</a>
        <ul>
          <li>
            <ul>
              <li class="logo"><img src="https://hatching.io/static/images/rf-hatching-white.svg" alt="hatching"/></li>
              <li class="social">
                <a href="https://twitter.com/hatching_io" target="_blank">
                  <i class="icon-twitter"></i>
                </a>
                <a href="https://www.linkedin.com/company/hatching" target="_blank">
                  <i class="icon-linkedin"></i>
                </a>
                <a href="https://www.github.com/hatching" target="_blank">
                  <i class="icon-github"></i>
                </a>
              </li>
            </ul>
          </li>
          <li>
            Hatching International B.V.<br />
            The Netherlands<br/>
            <br />
            Email us: <a href="mailto:info@hatching.io">info@hatching.io</a>
          </li>
          <li>
            IBAN: NL52 INGB 0006 9672 73<br />
            BIC: INGBNL2A<br />
            ING Groep N.V.<br />
            Amsterdam-Zuidoost<br />
            <br />
            REG: 64146707<br />
            VAT: NL855541891B01
          </li>
        </ul>
      </article>
      <div class="form hidden">
        <div class="form-logo">
          <img src="https://hatching.io/static/images/rf-hatching-white.svg" alt="Hatching"/>
        </div>
        <a href="#" class="form-close" title="Close (or press esc)"></a>

        <div class="container">
          <h1>Contact us</h1>
          <h3>Feel free to inquire or request about our services.</h3>
          <form>
            <fieldset>
              <div class="field">
                <div class="input is-required">
                  <input id="form-name" name="name" placeholder="Name" />
                </div>
              </div>
              <div class="field">
                <div class="input is-required">
                  <input id="form-email" name="email" placeholder="Email" />
                </div>
              </div>
              <div class="field">
                <div class="input">
                  <input id="form-phone" name="phone" placeholder="Phone number" />
                </div>
              </div>
              <div class="field">
                <div class="input">
                  <input id="form-company" name="company" placeholder="Company" />
                </div>
              </div>
            </fieldset>
            <fieldset>
              <div class="input required">
                <textarea id="form-message" name="message" placeholder="Write a message"></textarea>
              </div>
              <div class="button-group">
                <button type="reset" class="button button-variant-2 button-transparent">Reset</button>
                <button type="submit" class="button button-variant-1">Send</button>
              </div>
            </fieldset>
          </form>
        </div>

      </div>
    </footer>
    <script src="https://hatching.io/static/js/hatching.js?1726233262"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          if(window.main && window.main instanceof Function) {
            window.main();
          }
          initForm();

          
          
        });
    </script>
  </body>
</html>
